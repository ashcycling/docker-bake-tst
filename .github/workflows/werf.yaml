name: werf
run-name: ${{ github.actor }} using werf for build in ${{ github.ref_name }} ðŸš€
on: [workflow_dispatch]
jobs:
  build:
    runs-on: self-hosted
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # - name: Set up Docker Buildx
      #   uses: docker/setup-buildx-action@v3

      - name: Install werf
        uses: werf/actions/install@v2

      - name: cr login
        run: werf cr login -u ${{ github.repository_owner }} -p ${{ secrets.TOKEN_PKG }} ghcr.io 

      - name: converge
        run: |
          . $(werf ci-env github --as-file)
          werf converge
        env:
          WERF_REPO: ghcr.io/${{ github.repository }}
          WERF_USE_CUSTOM_TAG: "%image%-v0.3"
          WERF_BUILDAH_MODE: auto
          # WERF_REPO: ghcr.io/${{ github.repository_owner }}/${{ github.ref_name}}
          # WERF_REPO: ghcr.io/${{ github.repository_owner }}/qrc-gen/consumer:${{ github.ref_name }}